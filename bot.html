<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>One Plant Enhanced Chatbot</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #f8f8f8;
      margin: 0;
      padding: 0;
    }
    #chat-widget {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      background-color: #ffffff;
      border: 2px solid #000;
      border-radius: 1rem;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
      width: 370px;
      max-height: 550px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      z-index: 9999;
    }
    .chat-header {
      background: #000;
      color: white;
      padding: 1rem;
      font-size: 1.1rem;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .chat-close {
      background: transparent;
      border: none;
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
    }
    .chat-messages {
      flex: 1;
      padding: 1rem;
      overflow-y: auto;
      font-size: 0.95rem;
    }
    .chat-input {
      display: flex;
      border-top: 1px solid #ddd;
    }
    .chat-input input {
      flex: 1;
      border: none;
      padding: 0.75rem;
      font-size: 1rem;
    }
    .chat-input button {
      background: #1b5e20;
      color: white;
      border: none;
      padding: 0.75rem 1rem;
      cursor: pointer;
    }
    .quick-replies {
      display: flex;
      flex-wrap: wrap;
      padding: 0.5rem;
      gap: 0.5rem;
    }
    .quick-replies button {
      background: #1b5e20;
      border: none;
      border-radius: 999px;
      padding: 0.4rem 0.75rem;
      font-size: 0.8rem;
      cursor: pointer;
      color: white;
    }
    .product-card {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 0.75rem;
      margin-top: 0.5rem;
      background: #fff;
      display: flex;
      gap: 0.75rem;
      align-items: center;
    }
    .product-card img {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 6px;
      border: 1px solid #eee;
    }
    .product-info {
      flex: 1;
    }
    .product-info h4 {
      margin: 0 0 0.25rem;
      font-size: 1rem;
      color: #000;
    }
    .product-info p {
      margin: 0;
      font-size: 0.85rem;
      color: #444;
    }
  </style>
</head>
<body>

<div id="chat-widget">
  <div class="chat-header">
    üåø One Plant BudBot
    <button class="chat-close" onclick="document.getElementById('chat-widget').style.display='none'">‚úï</button>
  </div>
  <div class="chat-messages" id="messages">
    <div><strong>Bot:</strong> Ask me for weed by vibe (‚Äúchill‚Äù), type (‚Äúsativa‚Äù), effect (‚Äúenergizing‚Äù), flavour (‚Äúcitrus‚Äù), THC/CBD %, or category ‚¨áÔ∏è</div>
  </div>
  <div class="quick-replies">
    <button onclick="handleQuick('cheap indica')">Cheap Indica</button>
    <button onclick="handleQuick('relaxing hybrid')">Relaxing Hybrid</button>
    <button onclick="handleQuick('under $12')">Under $12/g</button>
    <button onclick="handleQuick('high THC')">High THC</button>
    <button onclick="handleQuick('CBD rich')">CBD Rich</button>
    <button onclick="handleQuick('citrus flavour')">Citrus Flavour</button>
    <button onclick="handleQuick('edibles')">Edibles</button>
    <button onclick="handleQuick('vapes')">Vapes</button>
    <button onclick="handleQuick('pre-rolls')">Pre-Rolls</button>
    <button onclick="handleQuick('beverages')">Beverages</button>
    <button onclick="handleQuick('capsules')">Capsules</button>
    <button onclick="handleQuick('oils')">Oils</button>
    <button onclick="handleQuick('sleep')">Sleep</button>
    <button onclick="handleQuick('energizing')">Energizing</button>
    <button onclick="handleQuick('sweet')">Sweet</button>
  </div>
  <div class="chat-input">
    <input type="text" id="userInput" placeholder="Type a question...">
    <button onclick="handleSend()">Send</button>
  </div>
</div>

<script>
const products = [
  {
    name: "Mandarin Cookies",
    type: "sativa",
    grams: 3.5,
    price: 23.43,
    category: "Dried Flower",
    tags: ["fruity", "citrus", "high-thc"],
    desc: "Tangy citrus, 25‚Äì31% THC.",
    img: "https://oneplant-new-waio-app.b-cdn.net/media/f/5f/7e/05/16/5f7e0516-8486-4449-b5cb-dc1996c62a47.jpg"
  },
  {
    name: "Banana OG Pre-Roll",
    type: "indica",
    grams: 3.5,
    price: 22.40,
    category: "Pre-Rolls",
    tags: ["pre-roll", "banana", "chill"],
    desc: "Smooth indica with banana flavour. 22‚Äì29.5% THC.",
    img: "https://oneplant-new-waio-app.b-cdn.net/media/f/7d/f5/3d/28/7df53d28-5b8b-4cef-843a-d634aa6ef074.jpg"
  },
  {
    name: "Mandarin Cookies (28g)",
    type: "sativa",
    grams: 28,
    price: 99.99,
    category: "Dried Flower",
    tags: ["flower", "sale", "bundle"],
    desc: "Back Forty | 28g | THC: 25‚Äì31%",
    img: "https://oneplant-new-waio-app.b-cdn.net/media/f/04/7d/71/b5/047d71b5-86a6-4ae7-a5cf-16e50f374f8f.jpg"
  },
  {
    name: "Panda Puff",
    type: "indica",
    grams: 28,
    price: 104.76,
    category: "Dried Flower",
    tags: ["flower", "plant perks", "relax"],
    desc: "Back Forty | 28g | THC: 24‚Äì30% | CBD: 1%",
    img: "https://oneplant-new-waio-app.b-cdn.net/media/f/3b/9f/d0/ec/3b9fd0ec-4045-43c3-beb9-c0856c70aa0f.jpg"
  },
  {
    name: "Panda Puff Pre-Roll",
    type: "indica",
    grams: 3.5,
    price: 22.40,
    category: "Pre-Rolls",
    tags: ["pre-roll", "relax", "indica"],
    desc: "Back Forty | 10√ó0.35g | THC: 24.5‚Äì28%",
    img: "https://oneplant-new-waio-app.b-cdn.net/media/f/de/75/e7/6d/de75e76d-a429-4a27-a93d-5dddd4555bf0.jpg"
  },
  {
    name: "Jack Haze Pre-Roll",
    type: "sativa",
    grams: 1,
    price: 9.84,
    category: "Pre-Rolls",
    tags: ["pre-roll", "sativa", "energize"],
    desc: "2x0.5g. Uplifting and herbal. THC 17‚Äì23%.",
    img: "https://oneplant-new-waio-app.b-cdn.net/media/f/4c/6d/4a/fa/4c6d4afa-0a66-46b2-b196-47952e39d236.jpg"
  },
  {
    name: "No.11 Distillate Delta 9 - Multi-Flavour",
    type: "hybrid",
    price: 4.49,
    category: "Edibles",
    tags: ["edible", "multi-flavour", "gummy"],
    desc: "4-pack soft chews, 10mg THC total. Flavours: cherry, watermelon, apple, strawberry.",
    img: "https://oneplant-new-waio-app.b-cdn.net/media/91280d5b8410/9a/b4/f1/84/9ab4f184-37b3-4155-bb0e-69a7a41b4ce5.jpg"
  },
  {
    name: "Hiway Sativa Pre-Roll",
    type: "sativa",
    grams: 2,
    price: 10.89,
    category: "Pre-Rolls",
    tags: ["pre-roll", "high-thc", "uplifting"],
    desc: "2x1g | THC: 21‚Äì25%",
    img: "https://oneplant-new-waio-app.b-cdn.net/media/f/f0/07/7b/22/f0077b22-72ad-4d67-9f86-ba6935567f98.jpg"
  },
  {
    name: "Redecan CBD Reign Drops",
    type: "blend",
    price: 36.15,
    category: "Oils and Sprays",
    tags: ["capsules", "cbd"],
    cbd: 13.6,
    desc: "Redecan | 30ml | THC: 0.3mg/ml | CBD: 13.6mg/ml",
    img: "https://oneplant-new-waio-app.b-cdn.net/media/f/b5/09/23/7d/b509237d-3adf-47f9-ae0f-bd701b74312a.jpg"
  },
  {
    name: "Mollo 10",
    type: "hybrid",
    price: 4.95,
    category: "Beverages",
    tags: ["drink", "relaxing"],
    desc: "Mollo | 355ml | 10mg THC | CBD: 2mg",
    img: "https://oneplant-new-waio-app.b-cdn.net/media/f/f0/52/0e/0e/f0520e0e-881e-4579-a331-bb83e722e8bd.jpg"
  },
  {
    name: "CBN Bedtime Blueberry Lemon Gummies",
    type: "indica",
    price: 6.49,
    category: "Edibles",
    tags: ["sleep", "edible", "blueberry", "cbn"],
    desc: "10mg THC + 5mg CBN | Sleep aid | Blueberry Lemon flavour",
    img: "https://oneplant-new-waio-app.b-cdn.net/media/f/fe/33/a8/51/fe33a851-2152-479b-bc01-ba80a009f406.jpg"
  },
  {
    name: "Peach Ringz Sativa 1:0 510 Cartridge",
    type: "sativa",
    price: 34.99,
    category: "Vapes",
    tags: ["vape", "cartridge", "fruity"],
    desc: "BoxHot | 1.2g | THC: 88‚Äì94% | CBD: 4.2%",
    img: "https://oneplant-new-waio-app.b-cdn.net/media/f/46/ad/a6/be/46ada6be-ab1d-4e72-bd9e-c67b7b38450c.jpg"
  }
];

const messages = document.getElementById('messages');
const input = document.getElementById('userInput');

input.addEventListener('keydown', function(e) {
  if (e.key === 'Enter') handleSend();
  if (e.key === 'Escape') document.getElementById('chat-widget').style.display = 'none';
});

function addMessage(text) {
  const div = document.createElement('div');
  div.innerHTML = text;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
}

function showProductCard(product) {
  const card = document.createElement('div');
  card.className = 'product-card';
  card.innerHTML = `
    <img src="${product.img}" alt="${product.name}" />
    <div class="product-info">
      <h4>üåø ${product.name}</h4>
      <p><strong>Type:</strong> ${product.type}</p>
      <p><strong>Price:</strong> $${product.price.toFixed(2)} / ${product.grams ? product.grams + 'g' : 'unit'}</p>
      <p>${product.desc}</p>
    </div>
  `;
  messages.appendChild(card);
  messages.scrollTop = messages.scrollHeight;
}

function handleQuick(text) {
  input.value = text;
  handleSend();
}

function handleSend() {
  const query = input.value.trim();
  if (!query) return;
  addMessage(`<strong>You:</strong> ${query}`);
  respondTo(query);
  input.value = '';
}

function respondTo(query) {
  const normalizedQuery = query.toLowerCase();
  const highTHC = /high thc|thc over (\d+)/.exec(normalizedQuery);
  const highCBD = /cbd rich|cbd over (\d+)/.exec(normalizedQuery);
  const minTHC = highTHC ? parseFloat(highTHC[1] || 20) : 0;
  const minCBD = highCBD ? parseFloat(highCBD[1] || 10) : 0;

  const results = products.filter(p => {
    const pricePerGram = p.grams ? p.price / p.grams : null;
    const matchesCheap = normalizedQuery.includes('cheap') || normalizedQuery.includes('under $12') || normalizedQuery.includes('under 12');
    const matchesTag = p.tags && p.tags.some(tag => normalizedQuery.includes(tag));
    const matchesType = ['indica', 'sativa', 'hybrid', 'blend'].some(t => normalizedQuery.includes(t)) ? normalizedQuery.includes(p.type) : true;
    const matchesCategory = p.category && normalizedQuery.includes(p.category.toLowerCase());
    const matchesTHC = p.thc ? parseFloat(p.thc) >= minTHC : true;
    const matchesCBD = p.cbd ? parseFloat(p.cbd) >= minCBD : true;

    return matchesType && matchesTHC && matchesCBD && (matchesCheap && pricePerGram < 12 || matchesTag || matchesCategory);
  });

  if (results.length > 0) {
    results.sort((a, b) => {
      const aRate = a.grams ? a.price / a.grams : a.price;
      const bRate = b.grams ? b.price / b.grams : b.price;
      return aRate - bRate;
    });
    results.forEach(showProductCard);
  } else {
    addMessage("<strong>Bot:</strong> Nothing matched that. Try 'indica', 'cheap', 'edibles', or 'high THC'.");
  }
}
</script>
</body>
</html>
